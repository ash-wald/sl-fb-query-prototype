<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F&B Query Filter Prototype</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçï</text></svg>">
</head>
<body>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <p>Loading prototype...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // Simple SVG icons
        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="21 21l-4.35-4.35"></path>
            </svg>
        );

        const MapPin = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Clock = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
        );

        const Utensils = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                <path d="M7 2v20"></path>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"></path>
            </svg>
        );

        const Filter = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
            </svg>
        );

        const Database = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
            </svg>
        );

        const ArrowRight = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12,5 19,12 12,19"></polyline>
            </svg>
        );

        const FoodQueryPrototype = () => {
            const [userQuery, setUserQuery] = useState('');

            // Real Cubs concessions data
            const mockFoodData = [
                {
                    item_id: "cubs_1",
                    name: "Chicago Style Hot Dog",
                    description: "",
                    location: {
                        section: "108",
                        stand_name: "Chicago Dogs",
                        zone: "Left Field"
                    },
                    category: "Hot Dogs",
                    dietary_info: {
                        allergens: ["Wheat"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Medium",
                        prep_time: "Standard"
                    },
                    popularity: {
                        popularity_score: 9,
                        is_signature: true,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 12
                    }
                },
                {
                    item_id: "cubs_2",
                    name: "Home Run Inn Pizza",
                    description: "",
                    location: {
                        section: "103",
                        stand_name: "Pizza Stand",
                        zone: "Left Field"
                    },
                    category: "Pizza",
                    dietary_info: {
                        allergens: ["Milk", "Wheat"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Medium",
                        prep_time: "Standard"
                    },
                    popularity: {
                        popularity_score: 8,
                        is_signature: true,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 14
                    }
                },
                {
                    item_id: "cubs_3",
                    name: "Plant Based NotCo Burger",
                    description: "",
                    location: {
                        section: "110",
                        stand_name: "Third Base Classics",
                        zone: "Third Base Side"
                    },
                    category: "Burgers",
                    dietary_info: {
                        allergens: ["Wheat"],
                        dietary_tags: ["vegetarian", "healthy"],
                        is_healthy: true
                    },
                    speed_metadata: {
                        estimated_wait: "Long",
                        prep_time: "Slow"
                    },
                    popularity: {
                        popularity_score: 7,
                        is_signature: false,
                        customer_favorite: false
                    },
                    pricing: {
                        price_range: "$$$",
                        average_price: 18
                    }
                },
                {
                    item_id: "cubs_4",
                    name: "Garrett Mix Popcorn",
                    description: "",
                    location: {
                        section: "119",
                        stand_name: "Chicago Dogs",
                        zone: "Right Field"
                    },
                    category: "Popcorn",
                    dietary_info: {
                        allergens: ["Milk", "Soy"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 9,
                        is_signature: true,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$",
                        average_price: 8
                    }
                },
                {
                    item_id: "cubs_5",
                    name: "Vienna Italian Beef Sandwich",
                    description: "",
                    location: {
                        section: "110",
                        stand_name: "Third Base Classics",
                        zone: "Third Base Side"
                    },
                    category: "Italian",
                    dietary_info: {
                        allergens: ["Soy"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Long",
                        prep_time: "Slow"
                    },
                    popularity: {
                        popularity_score: 8,
                        is_signature: true,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$$",
                        average_price: 16
                    }
                },
                {
                    item_id: "cubs_6",
                    name: "Nachos",
                    description: "",
                    location: {
                        section: "105",
                        stand_name: "Left Field Classics",
                        zone: "Left Field"
                    },
                    category: "Nachos",
                    dietary_info: {
                        allergens: ["Milk"],
                        dietary_tags: ["vegetarian"],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 7,
                        is_signature: false,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 10
                    }
                },
                {
                    item_id: "cubs_7",
                    name: "Soft Serve Ice Cream Helmet",
                    description: "",
                    location: {
                        section: "105",
                        stand_name: "Left Field Classics",
                        zone: "Left Field"
                    },
                    category: "Ice Cream",
                    dietary_info: {
                        allergens: ["Milk"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 6,
                        is_signature: false,
                        customer_favorite: false
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 12
                    }
                },
                {
                    item_id: "cubs_8",
                    name: "Pork Bao Bun",
                    description: "",
                    location: {
                        section: "117",
                        stand_name: "Marquee Classics",
                        zone: "Main Concourse"
                    },
                    category: "Signature Selections",
                    dietary_info: {
                        allergens: ["Wheat"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Medium",
                        prep_time: "Standard"
                    },
                    popularity: {
                        popularity_score: 9,
                        is_signature: true,
                        customer_favorite: false
                    },
                    pricing: {
                        price_range: "$$$",
                        average_price: 15
                    }
                }
            ];

            // Intent classification logic
            const classifyIntent = (query) => {
                const lowerQuery = query.toLowerCase();
                const intents = [];
                const filters = {};

                // Location-based intent
                const locationKeywords = ['near', 'section', 'gate', 'field', 'close', 'by'];
                const sectionMatch = lowerQuery.match(/section\s*(\d+)/);
                const zoneKeywords = {
                    'left field': 'Left Field',
                    'right field': 'Right Field', 
                    'first base': 'First Base Side',
                    'third base': 'Third Base Side'
                };

                if (locationKeywords.some(keyword => lowerQuery.includes(keyword)) || sectionMatch) {
                    intents.push('location_based');
                    if (sectionMatch) {
                        filters.section = sectionMatch[1];
                    }
                    Object.keys(zoneKeywords).forEach(keyword => {
                        if (lowerQuery.includes(keyword)) {
                            filters.zone = zoneKeywords[keyword];
                        }
                    });
                }

                // Dietary-based intent
                const dietaryKeywords = {
                    'vegetarian': 'vegetarian',
                    'vegan': 'vegan', 
                    'healthy': 'healthy'
                };
                
                Object.keys(dietaryKeywords).forEach(keyword => {
                    if (lowerQuery.includes(keyword)) {
                        intents.push('dietary_based');
                        filters.dietary = dietaryKeywords[keyword];
                    }
                });

                // Speed-based intent
                const speedKeywords = ['fast', 'quick', 'no line', 'short wait', 'fastest'];
                if (speedKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    intents.push('speed_based');
                    filters.speed = 'fast';
                }

                // Popularity-based intent
                const popularityKeywords = ['popular', 'best', 'favorite', 'recommended', 'signature'];
                if (popularityKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    intents.push('popularity_based');
                    filters.popularity = 'high';
                }

                // Category-based intent
                const categoryKeywords = {
                    'pizza': 'Pizza',
                    'hot dog': 'Hot Dogs',
                    'burger': 'Burgers',
                    'nachos': 'Nachos',
                    'ice cream': 'Ice Cream',
                    'popcorn': 'Popcorn'
                };

                Object.keys(categoryKeywords).forEach(keyword => {
                    if (lowerQuery.includes(keyword)) {
                        intents.push('category_based');
                        filters.category = categoryKeywords[keyword];
                    }
                });

                return { intents, filters };
            };

            // Filter and rank results
            const processQuery = (query, data) => {
                const { intents, filters } = classifyIntent(query);
                
                let results = [...data];
                let matchReasons = [];

                // Apply filters
                if (filters.section) {
                    results = results.filter(item => item.location.section === filters.section);
                    matchReasons.push(`Location: Section ${filters.section}`);
                }

                if (filters.zone) {
                    results = results.filter(item => item.location.zone === filters.zone);
                    matchReasons.push(`Zone: ${filters.zone}`);
                }

                if (filters.dietary) {
                    results = results.filter(item => {
                        if (filters.dietary === 'healthy') return item.dietary_info.is_healthy;
                        return item.dietary_info.dietary_tags.includes(filters.dietary);
                    });
                    matchReasons.push(`Dietary: ${filters.dietary}`);
                }

                if (filters.speed === 'fast') {
                    results = results.filter(item => item.speed_metadata.estimated_wait === 'Short');
                    matchReasons.push('Fast service');
                }

                if (filters.category) {
                    results = results.filter(item => item.category === filters.category);
                    matchReasons.push(`Category: ${filters.category}`);
                }

                // Ranking logic
                if (filters.popularity === 'high') {
                    results.sort((a, b) => b.popularity.popularity_score - a.popularity.popularity_score);
                    matchReasons.push('Popular items');
                }

                // Add match reasons to each result
                results = results.map(item => ({
                    ...item,
                    match_reasons: matchReasons,
                    relevance_score: item.popularity.popularity_score + (item.popularity.is_signature ? 2 : 0)
                }));

                return {
                    intents,
                    filters,
                    results: results.slice(0, 5),
                    total_results: results.length,
                    match_reasons: matchReasons
                };
            };

            const queryResults = useMemo(() => {
                if (!userQuery.trim()) return null;
                return processQuery(userQuery, mockFoodData);
            }, [userQuery]);

            const sampleQueries = [
                "What vegetarian food is near section 108?",
                "What's the fastest food option?", 
                "Popular food at left field",
                "Chicago style hot dogs",
                "Signature items at Wrigley"
            ];

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="mb-8">
                        <h1 className="text-3xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                            <Database />
                            F&B Query Filter Prototype
                        </h1>
                        <p className="text-gray-600">
                            Demonstrate how user queries translate to search filters and results (using real Cubs data)
                        </p>
                    </div>

                    {/* Query Input */}
                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            User Query
                        </label>
                        <div className="relative">
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <Search />
                            </div>
                            <input
                                type="text"
                                value={userQuery}
                                onChange={(e) => setUserQuery(e.target.value)}
                                placeholder="Try: 'What vegetarian food is near section 108?'"
                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                        </div>
                        
                        {/* Sample Queries */}
                        <div className="mt-4">
                            <p className="text-sm text-gray-600 mb-2">Try these sample queries:</p>
                            <div className="flex flex-wrap gap-2">
                                {sampleQueries.map((query, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setUserQuery(query)}
                                        className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200 transition-colors"
                                    >
                                        {query}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {queryResults && (
                        <>
                            {/* Intent Analysis */}
                            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Filter />
                                    Intent Analysis & Filters
                                </h2>
                                
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h3 className="font-medium text-gray-900 mb-2">Detected Intents:</h3>
                                        <div className="space-y-1">
                                            {queryResults.intents.map((intent, index) => (
                                                <span
                                                    key={index}
                                                    className="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm mr-2 mb-1"
                                                >
                                                    {intent.replace('_', ' ')}
                                                </span>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="font-medium text-gray-900 mb-2">Applied Filters:</h3>
                                        <div className="space-y-1">
                                            {Object.entries(queryResults.filters).map(([key, value]) => (
                                                <div key={key} className="text-sm">
                                                    <span className="font-medium text-gray-700">{key}:</span>
                                                    <span className="ml-1 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                                                        {value}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* SQL-like Query Visualization */}
                                <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                                    <h3 className="font-medium text-gray-900 mb-2">Equivalent SQL Query:</h3>
                                    <code className="text-sm text-gray-800 block">
                                        SELECT * FROM food_items<br/>
                                        WHERE 1=1
                                        {Object.entries(queryResults.filters).map(([key, value]) => (
                                            <span key={key}>
                                                <br/>&nbsp;&nbsp;AND {key} = '{value}'
                                            </span>
                                        ))}
                                        <br/>ORDER BY popularity_score DESC
                                        <br/>LIMIT 5;
                                    </code>
                                </div>
                            </div>

                            {/* Results */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-xl font-semibold flex items-center gap-2">
                                        <Utensils />
                                        Query Results ({queryResults.total_results} found)
                                    </h2>
                                    <span className="text-sm text-gray-600">
                                        Showing top {queryResults.results.length} results
                                    </span>
                                </div>

                                <div className="space-y-4">
                                    {queryResults.results.map((item, index) => (
                                        <div key={item.item_id} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                            <div className="flex items-start justify-between">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <h3 className="font-semibold text-lg text-gray-900">{item.name}</h3>
                                                        {item.popularity.is_signature && (
                                                            <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">
                                                                Signature
                                                            </span>
                                                        )}
                                                        {item.popularity.customer_favorite && (
                                                            <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                                                                Fan Favorite
                                                            </span>
                                                        )}
                                                    </div>
                                                    
                                                    <div className="grid md:grid-cols-3 gap-4 text-sm mb-3">
                                                        <div className="flex items-center gap-1">
                                                            <MapPin />
                                                            <span className="font-medium">{item.location.stand_name}</span>
                                                            <span className="text-gray-500">(Section {item.location.section})</span>
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-1">
                                                            <Clock />
                                                            <span>Wait: {item.speed_metadata.estimated_wait}</span>
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-1">
                                                            <span className="font-medium">Price: {item.pricing.price_range}</span>
                                                            <span className="text-gray-500">(~${item.pricing.average_price})</span>
                                                        </div>
                                                    </div>

                                                    {item.dietary_info.dietary_tags.length > 0 && (
                                                        <div className="flex flex-wrap gap-1">
                                                            {item.dietary_info.dietary_tags.map((tag, tagIndex) => (
                                                                <span
                                                                    key={tagIndex}
                                                                    className="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs"
                                                                >
                                                                    {tag}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                <div className="ml-4 text-right">
                                                    <div className="text-sm font-medium text-gray-900">
                                                        Relevance: {item.relevance_score}/10
                                                    </div>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        Popularity: {item.popularity.popularity_score}/10
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Match Reasons */}
                                            {item.match_reasons.length > 0 && (
                                                <div className="mt-3 pt-3 border-t border-gray-100">
                                                    <div className="flex items-center gap-2 text-sm text-gray-600">
                                                        <ArrowRight />
                                                        <span>Matches: {item.match_reasons.join(', ')}</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                {queryResults.results.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        No results found for your query. Try adjusting your search terms.
                                    </div>
                                )}
                            </div>
                        </>
                    )}

                    {!queryResults && (
                        <div className="bg-white rounded-lg shadow-md p-8 text-center">
                            <div className="w-12 h-12 text-gray-400 mx-auto mb-4">
                                <Search />
                            </div>
                            <h3 className="text-lg font-medium text-gray-900 mb-2">Ready to Search</h3>
                            <p className="text-gray-600">
                                Enter a query above to see how it gets processed into filters and results
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        // Mount the component
        try {
            ReactDOM.render(<FoodQueryPrototype />, document.getElementById('root'));
        } catch (error) {
            console.error('Error rendering component:', error);
            document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">Error loading prototype. Please refresh the page.</div>';
        }
    </script>
</body>
</html>
