<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F&B Query Filter Prototype</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçï</text></svg>">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // Lucide React icons as simple SVG components
        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="21 21l-4.35-4.35"></path>
            </svg>
        );

        const MapPin = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Clock = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
        );

        const Utensils = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                <path d="M7 2v20"></path>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"></path>
            </svg>
        );

        const Filter = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
            </svg>
        );

        const Database = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
            </svg>
        );

        const ArrowRight = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12,5 19,12 12,19"></polyline>
            </svg>
        );

        const FoodQueryPrototype = () => {
            const [userQuery, setUserQuery] = useState('');

            // Mock F&B data - replace with your real venue data
            const mockFoodData = [
                {
                    item_id: "001",
                    name: "Classic Cheesesteak",
                    description: "Authentic Philly cheesesteak with provolone",
                    location: {
                        section: "Section 136",
                        stand_name: "Tony Luke's",
                        zone: "Third Base Side",
                        gate_proximity: ["Gate C", "Gate D"]
                    },
                    category: "Sandwiches",
                    dietary_info: {
                        allergens: ["gluten", "dairy"],
                        dietary_tags: ["gluten_free_available"],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Medium",
                        prep_time: "Standard"
                    },
                    popularity: {
                        popularity_score: 9,
                        is_signature: true,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 14
                    }
                },
                {
                    item_id: "002", 
                    name: "Veggie Wrap",
                    description: "Fresh vegetables with hummus in spinach tortilla",
                    location: {
                        section: "Section 118",
                        stand_name: "Fresh Garden Stand",
                        zone: "Left Field",
                        gate_proximity: ["Gate A", "Gate B"]
                    },
                    category: "Healthy",
                    dietary_info: {
                        allergens: [],
                        dietary_tags: ["vegetarian", "vegan", "healthy"],
                        is_healthy: true
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 7,
                        is_signature: false,
                        customer_favorite: false
                    },
                    pricing: {
                        price_range: "$",
                        average_price: 8
                    }
                },
                {
                    item_id: "003",
                    name: "Margherita Pizza",
                    description: "Fresh mozzarella, basil, and tomato sauce",
                    location: {
                        section: "Section 122",
                        stand_name: "Slice Heaven",
                        zone: "Third Base Side", 
                        gate_proximity: ["Gate C"]
                    },
                    category: "Pizza",
                    dietary_info: {
                        allergens: ["gluten", "dairy"],
                        dietary_tags: ["vegetarian"],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Medium",
                        prep_time: "Standard"
                    },
                    popularity: {
                        popularity_score: 8,
                        is_signature: false,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 12
                    }
                },
                {
                    item_id: "004",
                    name: "Hot Dog",
                    description: "All-beef hot dog with classic toppings",
                    location: {
                        section: "Section 108",
                        stand_name: "Ballpark Dogs",
                        zone: "Right Field",
                        gate_proximity: ["Gate E"]
                    },
                    category: "Classic",
                    dietary_info: {
                        allergens: ["gluten"],
                        dietary_tags: [],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 6,
                        is_signature: false,
                        customer_favorite: false
                    },
                    pricing: {
                        price_range: "$",
                        average_price: 6
                    }
                },
                {
                    item_id: "005",
                    name: "Loaded Nachos",
                    description: "Tortilla chips with cheese, jalape√±os, and sour cream",
                    location: {
                        section: "Section 140",
                        stand_name: "Nacho Libre",
                        zone: "First Base Side",
                        gate_proximity: ["Gate D", "Gate E"]
                    },
                    category: "Snacks",
                    dietary_info: {
                        allergens: ["dairy"],
                        dietary_tags: ["vegetarian"],
                        is_healthy: false
                    },
                    speed_metadata: {
                        estimated_wait: "Short",
                        prep_time: "Fast"
                    },
                    popularity: {
                        popularity_score: 8,
                        is_signature: false,
                        customer_favorite: true
                    },
                    pricing: {
                        price_range: "$$",
                        average_price: 11
                    }
                }
            ];

            // Intent classification logic
            const classifyIntent = (query) => {
                const lowerQuery = query.toLowerCase();
                const intents = [];
                const filters = {};

                // Location-based intent
                const locationKeywords = ['near', 'section', 'gate', 'field', 'close', 'by'];
                const sectionMatch = lowerQuery.match(/section\s*(\d+)/);
                const gateMatch = lowerQuery.match(/gate\s*([a-z])/i);
                const zoneKeywords = {
                    'left field': 'Left Field',
                    'right field': 'Right Field', 
                    'first base': 'First Base Side',
                    'third base': 'Third Base Side'
                };

                if (locationKeywords.some(keyword => lowerQuery.includes(keyword)) || sectionMatch || gateMatch) {
                    intents.push('location_based');
                    if (sectionMatch) {
                        filters.section = `Section ${sectionMatch[1]}`;
                    }
                    if (gateMatch) {
                        filters.gate = `Gate ${gateMatch[1].toUpperCase()}`;
                    }
                    Object.keys(zoneKeywords).forEach(keyword => {
                        if (lowerQuery.includes(keyword)) {
                            filters.zone = zoneKeywords[keyword];
                        }
                    });
                }

                // Dietary-based intent
                const dietaryKeywords = {
                    'vegetarian': 'vegetarian',
                    'vegan': 'vegan', 
                    'gluten free': 'gluten_free_available',
                    'healthy': 'healthy'
                };
                
                Object.keys(dietaryKeywords).forEach(keyword => {
                    if (lowerQuery.includes(keyword)) {
                        intents.push('dietary_based');
                        filters.dietary = dietaryKeywords[keyword];
                    }
                });

                // Speed-based intent
                const speedKeywords = ['fast', 'quick', 'no line', 'short wait', 'fastest'];
                if (speedKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    intents.push('speed_based');
                    filters.speed = 'fast';
                }

                // Popularity-based intent
                const popularityKeywords = ['popular', 'best', 'favorite', 'recommended', 'signature'];
                if (popularityKeywords.some(keyword => lowerQuery.includes(keyword))) {
                    intents.push('popularity_based');
                    filters.popularity = 'high';
                }

                // Category-based intent
                const categoryKeywords = {
                    'pizza': 'Pizza',
                    'sandwich': 'Sandwiches',
                    'hot dog': 'Classic',
                    'nachos': 'Snacks',
                    'healthy': 'Healthy'
                };

                Object.keys(categoryKeywords).forEach(keyword => {
                    if (lowerQuery.includes(keyword)) {
                        intents.push('category_based');
                        filters.category = categoryKeywords[keyword];
                    }
                });

                return { intents, filters };
            };

            // Filter and rank results
            const processQuery = (query, data) => {
                const { intents, filters } = classifyIntent(query);
                
                let results = [...data];
                let matchReasons = [];

                // Apply filters
                if (filters.section) {
                    // Check both primary section and all sections
                    results = results.filter(item => 
                        item.location.section === filters.section ||
                        item.location.all_sections?.some(section => section === filters.section)
                    );
                    matchReasons.push(`Location: ${filters.section}`);
                }

                if (filters.gate) {
                    results = results.filter(item => item.location.gate_proximity.includes(filters.gate));
                    matchReasons.push(`Near ${filters.gate}`);
                }

                if (filters.zone) {
                    results = results.filter(item => item.location.zone === filters.zone);
                    matchReasons.push(`Zone: ${filters.zone}`);
                }

                if (filters.dietary) {
                    results = results.filter(item => {
                        if (filters.dietary === 'healthy') return item.dietary_info.is_healthy;
                        return item.dietary_info.dietary_tags.includes(filters.dietary);
                    });
                    matchReasons.push(`Dietary: ${filters.dietary.replace('_', ' ')}`);
                }

                if (filters.speed === 'fast') {
                    results = results.filter(item => item.speed_metadata.estimated_wait === 'Short');
                    matchReasons.push('Fast service');
                }

                if (filters.category) {
                    results = results.filter(item => item.category === filters.category);
                    matchReasons.push(`Category: ${filters.category}`);
                }

                // Ranking logic
                if (filters.popularity === 'high') {
                    results.sort((a, b) => b.popularity.popularity_score - a.popularity.popularity_score);
                    matchReasons.push('Popular items');
                }

                // Add match reasons to each result
                results = results.map(item => ({
                    ...item,
                    match_reasons: matchReasons,
                    relevance_score: calculateRelevanceScore(item, filters)
                }));

                return {
                    intents,
                    filters,
                    results: results.slice(0, 5), // Top 5 results
                    total_results: results.length,
                    match_reasons: matchReasons
                };
            };

            const calculateRelevanceScore = (item, filters) => {
                let score = item.popularity.popularity_score;
                
                if (filters.speed === 'fast' && item.speed_metadata.estimated_wait === 'Short') score += 2;
                if (filters.popularity === 'high' && item.popularity.customer_favorite) score += 3;
                if (item.popularity.is_signature) score += 1;
                
                return score;
            };

            const queryResults = useMemo(() => {
                if (!userQuery.trim()) return null;
                return processQuery(userQuery, mockFoodData);
            }, [userQuery]);

            const sampleQueries = [
                "What vegetarian food is near section 108?",
                "What's the fastest food option?", 
                "Popular food at left field",
                "Chicago style hot dogs",
                "Pizza near section 103",
                "Healthy options close to me",
                "Signature items at Wrigley",
                "Rotational menu items"
            ];

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="mb-8">
                        <h1 className="text-3xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                            <Database />
                            F&B Query Filter Prototype
                        </h1>
                        <p className="text-gray-600">
                            Demonstrate how user queries translate to search filters and results
                        </p>
                    </div>

                    {/* Query Input */}
                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            User Query
                        </label>
                        <div className="relative">
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <Search />
                            </div>
                            <input
                                type="text"
                                value={userQuery}
                                onChange={(e) => setUserQuery(e.target.value)}
                                placeholder="Try: 'What vegetarian food is near section 108?'"
                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                        </div>
                        
                        {/* Sample Queries */}
                        <div className="mt-4">
                            <p className="text-sm text-gray-600 mb-2">Try these sample queries:</p>
                            <div className="flex flex-wrap gap-2">
                                {sampleQueries.map((query, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setUserQuery(query)}
                                        className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200 transition-colors"
                                    >
                                        {query}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {queryResults && (
                        <>
                            {/* Intent Analysis */}
                            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Filter />
                                    Intent Analysis & Filters
                                </h2>
                                
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h3 className="font-medium text-gray-900 mb-2">Detected Intents:</h3>
                                        <div className="space-y-1">
                                            {queryResults.intents.map((intent, index) => (
                                                <span
                                                    key={index}
                                                    className="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm mr-2 mb-1"
                                                >
                                                    {intent.replace('_', ' ')}
                                                </span>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="font-medium text-gray-900 mb-2">Applied Filters:</h3>
                                        <div className="space-y-1">
                                            {Object.entries(queryResults.filters).map(([key, value]) => (
                                                <div key={key} className="text-sm">
                                                    <span className="font-medium text-gray-700">{key}:</span>
                                                    <span className="ml-1 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                                                        {value}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* SQL-like Query Visualization */}
                                <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                                    <h3 className="font-medium text-gray-900 mb-2">Equivalent SQL Query:</h3>
                                    <code className="text-sm text-gray-800 block">
                                        SELECT * FROM food_items<br/>
                                        WHERE 1=1
                                        {Object.entries(queryResults.filters).map(([key, value]) => (
                                            <span key={key}>
                                                <br/>&nbsp;&nbsp;AND {key} = '{value}'
                                            </span>
                                        ))}
                                        <br/>ORDER BY popularity_score DESC
                                        <br/>LIMIT 5;
                                    </code>
                                </div>
                            </div>

                            {/* Results */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-xl font-semibold flex items-center gap-2">
                                        <Utensils />
                                        Query Results ({queryResults.total_results} found)
                                    </h2>
                                    <span className="text-sm text-gray-600">
                                        Showing top {queryResults.results.length} results
                                    </span>
                                </div>

                                <div className="space-y-4">
                                    {queryResults.results.map((item, index) => (
                                        <div key={item.item_id} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                            <div className="flex items-start justify-between">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <h3 className="font-semibold text-lg text-gray-900">{item.name}</h3>
                                                        {item.popularity.is_signature && (
                                                            <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">
                                                                Signature
                                                            </span>
                                                        )}
                                                        {item.popularity.customer_favorite && (
                                                            <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                                                                Fan Favorite
                                                            </span>
                                                        )}
                                                    </div>
                                                    
                                                    <p className="text-gray-600 mb-3">{item.description}</p>
                                                    
                                                    <div className="grid md:grid-cols-3 gap-4 text-sm">
                                                        <div className="flex items-center gap-1">
                                                            <MapPin />
                                                            <span className="font-medium">{item.location.stand_name}</span>
                                                            <span className="text-gray-500">({item.location.section})</span>
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-1">
                                                            <Clock />
                                                            <span>Wait: {item.speed_metadata.estimated_wait}</span>
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-1">
                                                            <span className="font-medium">Price: {item.pricing.price_range}</span>
                                                            <span className="text-gray-500">(~${item.pricing.average_price})</span>
                                                        </div>
                                                    </div>

                                                    {item.dietary_info.dietary_tags.length > 0 && (
                                                        <div className="mt-2 flex flex-wrap gap-1">
                                                            {item.dietary_info.dietary_tags.map((tag, tagIndex) => (
                                                                <span
                                                                    key={tagIndex}
                                                                    className="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs"
                                                                >
                                                                    {tag.replace('_', ' ')}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                <div className="ml-4 text-right">
                                                    <div className="text-sm font-medium text-gray-900">
                                                        Relevance: {item.relevance_score}/10
                                                    </div>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        Popularity: {item.popularity.popularity_score}/10
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Match Reasons */}
                                            {item.match_reasons.length > 0 && (
                                                <div className="mt-3 pt-3 border-t border-gray-100">
                                                    <div className="flex items-center gap-2 text-sm text-gray-600">
                                                        <ArrowRight />
                                                        <span>Matches: {item.match_reasons.join(', ')}</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                {queryResults.results.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        No results found for your query. Try adjusting your search terms.
                                    </div>
                                )}
                            </div>
                        </>
                    )}

                    {!queryResults && (
                        <div className="bg-white rounded-lg shadow-md p-8 text-center">
                            <div className="w-12 h-12 text-gray-400 mx-auto mb-4">
                                <Search />
                            </div>
                            <h3 className="text-lg font-medium text-gray-900 mb-2">Ready to Search</h3>
                            <p className="text-gray-600">
                                Enter a query above to see how it gets processed into filters and results
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<FoodQueryPrototype />, document.getElementById('root'));
    </script>
</body>
</html>
